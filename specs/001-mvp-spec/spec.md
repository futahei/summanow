# 機能仕様書: Summanow MVP

**Feature Branch**: `001-mvp-spec`  
**作成日**: 2025-12-07  
**ステータス**: Draft  
**入力（ユーザー記述）**: "Summanow MVP specification for twice-daily crawling, AI summarization, and web display"

## ユーザーストーリー & テスト観点（必須）

### ユーザーストーリー 1 - 朝夕の要約ダイジェストを確認する (優先度: P1)

PR 担当者や情報収集を行う読者として、朝・夕に公開されたニュースとプレスリリースの要約を一覧で素早く把握したい。

**優先度の理由**  
日次で価値を提供する中核体験であり、一覧が無ければサービスの存在意義が成立しないため。

**独立テスト方法**  
クロール後に Web UI を開き、直近の新着記事が公開日時順で表示され、各項目に要約が含まれることを確認する。

**受け入れ条件（Acceptance Scenarios）**:

- **前提**: システムに前回クロール以降の新着記事が保存されている。  
  **操作**: 利用者が記事一覧ページを開く。  
  **結果**: 最新記事が公開日時降順で並び、タイトル・媒体名・要約（1〜2 段落）・要約生成時刻が表示される。

- **前提**: 新着記事が存在しない。  
  **操作**: 利用者が記事一覧ページを開く。  
  **結果**: 「新着記事はありません」といった空状態表示が出る。

### ユーザーストーリー 2 - 要約から元記事へ移動する (優先度: P2)

読者として、気になる要約をクリックして詳細を確認し、元の記事へ遷移できるようにしたい。

**優先度の理由**  
一覧から深掘りできないとコンテンツの信頼性が担保できず、利用継続につながらないため。

**独立テスト方法**  
任意の記事カードを選択して詳細ページに移動し、要約全文・取得した本文の抜粋・元記事への外部リンクが表示されていることを確認する。

**受け入れ条件**:

- **前提**: 記事一覧に要約が表示されている。  
  **操作**: 利用者が任意の記事を選択する。  
  **結果**: 詳細ページで要約全文、取得した記事本文テキスト、媒体情報、元記事 URL が表示され外部リンクを新規タブで開ける。

### ユーザーストーリー 3 - クロール & 要約ジョブを管理する (優先度: P3)

運用担当者として、対象サイト追加前の MVP 期間でも確実に朝夕のジョブを実行し、失敗時にはログを確認できるようにしたい。

**優先度の理由**  
一覧・詳細の品質を保つためにクロールが安定稼働する必要があり、運用担当が状況を把握できないとサービスが成立しないため。

**独立テスト方法**  
手動トリガーでクロールジョブを実行し、処理履歴（開始・終了時刻、対象件数、エラー有無）が記録され、要約済み記事が UI に反映されることを検証する。

**受け入れ条件**:

- **前提**: クロール対象サイトが設定されている。  
  **操作**: 運用担当が手動スクリプトまたは管理用 CLI からクロールジョブを開始する。  
  **結果**: 新規記事が取得され、要約が生成され、一覧に反映されるとともにジョブログに実行ステータスが記録される。

- **前提**: ジョブ実行時に一部サイトからの取得が失敗した。  
  **操作**: 運用担当がジョブログを確認する。  
  **結果**: 失敗したサイトとステータスコード、再試行推奨タイミングがログに残り、次回実行時にリトライされる。

## ユースケース一覧

| UC ID | タイトル             | アクター | ゴール                                   | トリガー                     | 正常完了条件                                     |
| ----- | -------------------- | -------- | ---------------------------------------- | ---------------------------- | ------------------------------------------------ |
| UC-01 | 新着要約を閲覧する   | 読者     | 朝夕の新着要約を俯瞰する                 | ユーザーが一覧ページを開く   | 新着記事が降順で表示され、要約と公開日時が見える |
| UC-02 | 要約詳細を確認する   | 読者     | 気になる記事の詳細と原文リンクを確認する | 一覧から記事を選択           | 詳細ページに要約全文と外部リンクが表示される     |
| UC-03 | クロールを実行する   | 運用担当 | 指定サイトから新着記事を取得する         | スケジュールもしくは手動実行 | 新着記事が格納され、重複なしで保存される         |
| UC-04 | 要約を生成・保存する | システム | 新着記事を要約し閲覧可能にする           | クロール後の要約キュー投入   | 要約結果が 1〜2 段落の日本語テキストで保存される |
| UC-05 | 失敗ログを確認する   | 運用担当 | 次の対応を判断するため失敗原因を把握する | 失敗通知または日次点検       | 失敗理由と対象サイトがログで確認できる           |

## エッジケース（必須）

- 新着記事が 0 件の場合は空状態を表示し、前回の記事を再掲載しない。
- 同じ記事 URL が複数回取得された場合は重複を除外し、既存レコードに最新情報をマージする。
- 対象サイトのレスポンスが遅延・失敗した場合はリトライ回数を制限し、次回ジョブに再試行を委ねる（ログに記録）。
- AI 要約生成が失敗した場合は記事自体を表示しつつ「要約未生成」のラベルを付与し、再試行キューに登録する。
- 取得した本文が 0 文字または極端に短い場合は要約を生成せず、メタデータのみで表示する。
- 予定外の大量記事（件数急増）を検知した場合は次回ジョブまでに収集上限を超えないようバッチサイズを制御する。

## 機能要件（必須）

### 機能要件（Functional Requirements）

- **FR-001**: システムは企業プレスリリース 2 件・ネット新聞 1 件のクロール対象リストをソースコードに静的定義し、手動メンテナンス可能とする。
- **FR-002**: システムは朝（例: 07:00）と夕（例: 19:00）の 2 回、スケジュールに従ってクロールジョブを実行できるようにし、ジョブ完了後 5 分以内に結果を保存する。
- **FR-003**: システムはクロール時に各対象サイトから新着記事のタイトル、URL、媒体名、公開日、本文テキストを取得し、既存データと照合して重複を排除する。
- **FR-004**: システムは新規記事ごとに 1〜2 段落の日本語要約を外部 LLM サービスで生成し、要約テキストと使用モデル識別子・生成時刻を保存する。
- **FR-005**: システムは要約生成失敗時に原因（HTTP エラー、タイムアウトなど）を記録し、対象記事を再試行キューへ登録する。
- **FR-006**: システムは記事一覧ページで最新 48 時間分の要約を公開日時降順で表示し、1 行目に媒体名と公開時間を示す。
- **FR-007**: システムは記事詳細ページで要約全文、取得した本文テキスト、元記事への外部リンク、要約生成情報（生成日時・使用モデル）を提示する。
- **FR-008**: システムは閲覧回数の多い記事でも 3 秒以内に要約ページを描画できるよう、一覧および詳細データをキャッシュ可能な形式で提供する。
- **FR-009**: システムは手動クロールを実行する CLI またはスクリプトを提供し、運用担当がオンデマンドでジョブを走らせて状態を確認できるようにする。
- **FR-010**: システムは各クロールジョブについて開始時刻、終了時刻、処理件数、成功/失敗ステータス、失敗詳細を履歴に残す。
- **FR-011**: システムは要約を表示する画面が PC ブラウザ解像度で正常にレイアウトされ、スマートフォンでは主要コンテンツが崩れずに閲覧できる最低限のレスポンシブ対応を行う。
- **FR-012**: システムは robots.txt とサイト利用規約を遵守し、許可されたパスのみを取得対象とし、アクセスの間隔を対象サイトごとに設定できるようにする。

### 主要エンティティ

- **Site（サイト）**
  - 対象となるプレスリリース/ニュースサイト。識別子、名称、種類（企業/新聞）、トップ URL、クロール設定（許可パス、レート制限、実行時間帯）を保持。
  - Article、CrawlRun と 1 対多関係。

- **Article（記事）**
  - 取得した各記事のメタデータ。タイトル、URL、公開日時、媒体名、本文テキスト、取得日時、重複判定キーを持つ。
  - Summary と 1 対 1、Site と多対 1、CrawlRun と多対多（1 クロールで複数記事、記事は複数ジョブで再取得され得る）。

- **Summary（要約）**
  - Article に紐づく要約結果。要約本文（1〜2 段落）、生成日時、使用モデル識別子、生成プロンプト ID、生成結果信頼度（スコア）が含まれる。
  - Article と多対 1。

- **CrawlRun（クロール実行）**
  - ジョブごとの実行履歴。開始・終了時刻、対象サイト、処理件数、成功/失敗フラグ、失敗理由、トリガー種別（スケジュール/手動）を保持。
  - Site と多対 1、Article と多対多。

- **RetryQueue（再試行キュー）**
  - 要約や取得に失敗した記事の再処理用。対象 Article ID、失敗種別、再試行予定時刻、試行回数を管理。

## 前提・制約

- 対象サイトは MVP 期間中固定 3 件とし、変更はソースコード修正で行う。
- クロールおよび要約処理は AWS 無料枠のリソース使用を前提とし、1 ジョブあたりの API 呼び出し数を最小限に抑える。
- 外部 LLM サービスは商用利用可能なプランを前提とし、プロンプトと出力は監査のため永続化する。

## 成功指標 / Success Criteria（必須）

### 計測可能な成果

- **SC-001**: クロール完了後 5 分以内に 95% の新着記事が要約付きで一覧に反映される。
- **SC-002**: 朝夕 2 回のスケジュールジョブの成功率が 30 日平均で 95% 以上を維持する。
- **SC-003**: 要約詳細ページは 95% のアクセスで 3 秒以内に初回描画される（PC ブラウザ計測）。
- **SC-004**: 公開から 24 時間以内に登録された記事の 100% が元記事リンクおよび媒体情報を表示する。

## MVP でやらないこと（後続フェーズ送り）

- サイトの管理画面や UI からの対象サイト追加・編集機能。
- 配信リスト、タグ分類、通知（メール・Slack 等）といったパーソナライズ機能。
- 端末種別ごとの最適化やフルリッチなスマホ UI（最低限崩れない表示に留める）。
- 多言語要約や英語出力、サマリー精度のチューニング設定。
- ユーザーアカウント管理、ログイン、高度なアクセス制御。
- 高負荷時の分散クロールや大規模シャーディング対応。
- 広告配信、課金、閲覧履歴分析などの収益化機能。
